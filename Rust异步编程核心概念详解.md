# Rust å¼‚æ­¥ç¼–ç¨‹æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

æœ¬æ–‡æ¡£æ•´ç†äº† Rust å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒæ¦‚å¿µï¼ŒåŒ…æ‹¬ async/awaitã€Tokio è¿è¡Œæ—¶ã€ä»»åŠ¡è°ƒåº¦å’Œä¼˜é›…å…³é—­æœºåˆ¶ç­‰é‡è¦ä¸»é¢˜ã€‚

---

## ç›®å½•

1. [Async/Await å…³é”®å­—è¯¦è§£](#1-asyncawait-å…³é”®å­—è¯¦è§£)
2. [Tokio è¿è¡Œæ—¶å®Œæ•´ä»‹ç»](#2-tokio-è¿è¡Œæ—¶å®Œæ•´ä»‹ç»)
3. [tokio::spawn æ‰§è¡Œæœºåˆ¶](#3-tokiospawn-æ‰§è¡Œæœºåˆ¶)
4. [ä¼˜é›…å…³é—­ä¸ Broadcast Channel](#4-ä¼˜é›…å…³é—­ä¸-broadcast-channel)

---

## 1. Async/Await å…³é”®å­—è¯¦è§£

### 1.1 `async` å…³é”®å­—çš„ä½œç”¨

`async` å…³é”®å­—ç”¨äºå®šä¹‰**å¼‚æ­¥å‡½æ•°**ï¼Œæ ‡è®°ä¸€æ®µä»£ç å¯ä»¥å¼‚æ­¥æ‰§è¡Œï¼Œå®ƒä¼šå°†å‡½æ•°è½¬æ¢ä¸ºè¿”å› `Future` çš„å‡½æ•°ã€‚

```rust
// æ™®é€šå‡½æ•°
fn say_hello() {
    println!("Hello");
}

// å¼‚æ­¥å‡½æ•° - å®é™…è¿”å› impl Future<Output = ()>
async fn say_hello_async() {
    println!("Hello");
}
```

**å…³é”®ç‰¹ç‚¹ï¼š**
- `async fn` ä¸ä¼šç›´æ¥æ‰§è¡Œå‡½æ•°ä½“
- å®ƒè¿”å›ä¸€ä¸ª `Future` å¯¹è±¡
- `Future` ä»£è¡¨"æœªæ¥ä¼šå®Œæˆçš„è®¡ç®—"

**å®é™…è½¬æ¢ï¼š**
```rust
// ä½ å†™çš„ä»£ç 
async fn say_hello() {
    println!("ä½ å¥½ï¼æˆ‘æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°");
}

// ç¼–è¯‘å™¨çœ‹åˆ°çš„
fn say_hello() -> impl Future<Output = ()> {
    // ç¼–è¯‘å™¨ç”Ÿæˆçš„çŠ¶æ€æœº
}
```

---

### 1.2 `await` å…³é”®å­—çš„ä½œç”¨

`await` ç”¨äº**åœ¨éœ€è¦ç»“æœçš„åœ°æ–¹ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ**ã€‚å½“é‡åˆ° `.await` æ—¶ï¼š
1. **æš‚åœå½“å‰å‡½æ•°æ‰§è¡Œ**ï¼ˆè®©å‡º CPUï¼‰
2. **å…è®¸å…¶ä»–ä»»åŠ¡è¿è¡Œ**
3. **ç­‰å¾… Future å®Œæˆåæ¢å¤æ‰§è¡Œ**

```rust
async fn say_after_delay(message: &str, seconds: u64) {
    println!("â° ç­‰å¾… {} ç§’...", seconds);
    sleep(Duration::from_secs(seconds)).await; // .await æš‚åœæ‰§è¡Œ
    println!("â­ {}", message);
}
```

**æ‰§è¡Œæµç¨‹ï¼š**
```
1. æ‰“å° "ç­‰å¾… X ç§’..."
2. é‡åˆ° .await â†’ æš‚åœï¼Œè®©å‡º CPU
3. ï¼ˆè¿™æœŸé—´å…¶ä»–ä»»åŠ¡å¯ä»¥è¿è¡Œï¼‰
4. å»¶è¿Ÿç»“æŸ â†’ æ¢å¤æ‰§è¡Œ
5. æ‰“å°æ¶ˆæ¯
```

---

### 1.3 Future çš„æƒ°æ€§ç‰¹æ€§

**é‡è¦ï¼** `async` å‡½æ•°åˆ›å»ºçš„ Future æ˜¯**æƒ°æ€§çš„**ï¼Œå¿…é¡»è¢« `.await` æ‰ä¼šæ‰§è¡Œï¼š

```rust
async fn lazy_futures() {
    println!("=== Future çš„æƒ°æ€§ç‰¹æ€§ ===");
    
    // åˆ›å»º Future ä½†ä¸ await - è¿™ä¸ä¼šæ‰§è¡Œ
    let future = say_hello();
    println!("ğŸ“¦ Future å·²åˆ›å»ºï¼Œä½†è¿˜æ²¡æœ‰æ‰§è¡Œ");
    
    sleep(Duration::from_secs(1)).await;
    
    // ç°åœ¨ awaitï¼ŒFuture æ‰çœŸæ­£æ‰§è¡Œ
    println!("ğŸš€ ç°åœ¨æ‰§è¡Œ Futureï¼š");
    future.await;
}
```

---

### 1.4 ä¸²è¡Œ vs å¹¶å‘æ‰§è¡Œ

#### **ä¸²è¡Œæ‰§è¡Œ**ï¼ˆä½¿ç”¨ `.await`ï¼‰
```rust
async fn sequential_operations() {
    // è¿™äº›æ“ä½œä¼šä¾æ¬¡æ‰§è¡Œï¼ˆä¸²è¡Œï¼‰
    say_after_delay("ç¬¬ä¸€ä¸ªä»»åŠ¡å®Œæˆ", 1).await;
    say_after_delay("ç¬¬äºŒä¸ªä»»åŠ¡å®Œæˆ", 1).await;
    say_after_delay("ç¬¬ä¸‰ä¸ªä»»åŠ¡å®Œæˆ", 1).await;
    // æ€»è€—æ—¶ï¼š1 + 1 + 1 = 3 ç§’
}
```

#### **å¹¶å‘æ‰§è¡Œ**ï¼ˆä½¿ç”¨ `tokio::join!`ï¼‰
```rust
async fn concurrent_operations() {
    // ä½¿ç”¨ tokio::join! å®å¹¶å‘æ‰§è¡Œå¤šä¸ª Future
    let start = std::time::Instant::now();
    
    tokio::join!(
        say_after_delay("å¹¶å‘ä»»åŠ¡ 1 å®Œæˆ", 1),
        say_after_delay("å¹¶å‘ä»»åŠ¡ 2 å®Œæˆ", 1),
        say_after_delay("å¹¶å‘ä»»åŠ¡ 3 å®Œæˆ", 1),
    );
    
    // æ€»è€—æ—¶ï¼šçº¦ 1 ç§’ï¼ˆä¸‰ä¸ªä»»åŠ¡åŒæ—¶è¿è¡Œï¼‰
}
```

---

### 1.5 å·¥ä½œåŸç†

```rust
async fn example() {
    println!("æ­¥éª¤ 1");
    async_operation1().await;  // æš‚åœç‚¹ A
    println!("æ­¥éª¤ 2");
    async_operation2().await;  // æš‚åœç‚¹ B
    println!("æ­¥éª¤ 3");
}
```

**ç¼–è¯‘å™¨è½¬æ¢ä¸ºçŠ¶æ€æœºï¼š**
```
State 0: æ‰§è¡Œ "æ­¥éª¤ 1"ï¼Œå¯åŠ¨ operation1ï¼Œè¿›å…¥ State 1
State 1: ç­‰å¾… operation1 å®Œæˆï¼Œå®Œæˆåè¿›å…¥ State 2
State 2: æ‰§è¡Œ "æ­¥éª¤ 2"ï¼Œå¯åŠ¨ operation2ï¼Œè¿›å…¥ State 3
State 3: ç­‰å¾… operation2 å®Œæˆï¼Œå®Œæˆåè¿›å…¥ State 4
State 4: æ‰§è¡Œ "æ­¥éª¤ 3"ï¼Œå®Œæˆ
```

---

### 1.6 å…³é”®æ€»ç»“
async åˆ›å»ºå¼‚æ­¥ä¸Šä¸‹æ–‡ï¼Œ.await åœ¨è¯¥ä¸Šä¸‹æ–‡ä¸­ç­‰å¾…å…¶ä»–å¼‚æ­¥æ“ä½œ
Rust çš„ async/await æä¾›äº†é›¶æˆæœ¬æŠ½è±¡ï¼Œä½ åªåœ¨ä½¿ç”¨æ—¶æ”¯ä»˜å¼€é”€ï¼Œè®©å¼‚æ­¥ä»£ç æ—¢é«˜æ•ˆåˆæ˜“äºç¼–å†™å’Œç»´æŠ¤ã€‚

| æ¦‚å¿µ | ä½œç”¨ | æ¯”å–» |
|------|------|------|
| `async` | å®šä¹‰å¼‚æ­¥å‡½æ•°ï¼Œè¿”å› Future | ğŸ“ å†™ä¸€å¼ "æœªæ¥è¦åšçš„äº‹"çš„ä¾¿ç­¾ |
| `await` | ç­‰å¾… Future å®Œæˆ | â° ç­‰ä¾¿ç­¾ä¸Šçš„äº‹æƒ…å®Œæˆ |
| Future | ä»£è¡¨æœªæ¥çš„å€¼ | ğŸ“¦ å¿«é€’åŒ…è£¹ï¼ˆè¿˜æ²¡åˆ°è´§ï¼‰ |
| Runtime | æ‰§è¡Œ Future | ğŸšš å¿«é€’å…¬å¸ï¼ˆè´Ÿè´£é€è´§ï¼‰ |

**è®°å¿†å£è¯€ï¼š**
- `async` åˆ›å»ºå¼‚æ­¥ä»»åŠ¡ï¼ˆè¿”å› Futureï¼‰
- `await` ç­‰å¾…ä»»åŠ¡å®Œæˆï¼ˆæš‚åœè®©å‡ºï¼‰
- Future æ˜¯æƒ°æ€§çš„ï¼ˆä¸ await ä¸æ‰§è¡Œï¼‰
- Runtime æ˜¯å¼•æ“ï¼ˆé©±åŠ¨ä¸€åˆ‡è¿è¡Œï¼‰

æœ€ä½³å®è·µï¼š
âœ… éœ€è¦å¹¶å‘æ—¶ç”¨ tokio::join! æˆ– tokio::spawn
âœ… éœ€è¦ä¸²è¡Œæ—¶é€ä¸ª .await
âœ… I/O æ“ä½œï¼ˆç½‘ç»œã€æ–‡ä»¶ï¼‰é€‚åˆç”¨ async
âŒ CPU å¯†é›†è®¡ç®—ä¸é€‚åˆ asyncï¼ˆç”¨çº¿ç¨‹æ± ï¼‰

---

## 2. Tokio è¿è¡Œæ—¶å®Œæ•´ä»‹ç»

### 2.1 ä»€ä¹ˆæ˜¯ Tokioï¼Ÿ

**Tokio** æ˜¯ Rust æœ€æµè¡Œçš„**å¼‚æ­¥è¿è¡Œæ—¶**ï¼ˆasync runtimeï¼‰ï¼Œä¸ºç¼–å†™é«˜æ€§èƒ½å¼‚æ­¥ç¨‹åºæä¾›åŸºç¡€è®¾æ–½ã€‚

#### ç±»æ¯”ç†è§£ï¼š
- **Rust çš„ `async/await`**ï¼šæ±½è½¦çš„æ–¹å‘ç›˜å’Œæ²¹é—¨ï¼ˆæ§åˆ¶ç•Œé¢ï¼‰
- **Tokio**ï¼šæ±½è½¦çš„å‘åŠ¨æœºå’Œåº•ç›˜ï¼ˆé©±åŠ¨ç³»ç»Ÿï¼‰

**é‡è¦ï¼š** æ²¡æœ‰ Tokioï¼Œasync å‡½æ•°è¿”å› Futureï¼Œä½†ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚`async/await` åªæ˜¯è¯­æ³•ï¼Œæ— æ³•çœŸæ­£æ‰§è¡Œï¼

---

### 2.2 Tokio çš„æ ¸å¿ƒåŠŸèƒ½

#### 2.2.1 å¼‚æ­¥è¿è¡Œæ—¶ï¼ˆRuntimeï¼‰

Tokio æä¾›è¿è¡Œæ—¶æ¥é©±åŠ¨å¼‚æ­¥ä»£ç æ‰§è¡Œï¼š

```rust
#[tokio::main]  // â† è¿™ä¸ªå®åˆ›å»º Tokio è¿è¡Œæ—¶
async fn main() {
    // ä½ çš„å¼‚æ­¥ä»£ç 
}
```

**è¿è¡Œæ—¶è´Ÿè´£ï¼š**
- âœ… è°ƒåº¦å¼‚æ­¥ä»»åŠ¡
- âœ… ç®¡ç†çº¿ç¨‹æ± 
- âœ… å¤„ç† I/O äº‹ä»¶
- âœ… å”¤é†’æš‚åœçš„ Future

---

#### 2.2.2 ä»»åŠ¡è°ƒåº¦ï¼ˆTask Spawningï¼‰

```rust
async fn basic_spawn() {
    // spawn åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥ä»»åŠ¡ï¼Œç«‹å³è¿”å› JoinHandle
    let handle = tokio::spawn(async {
        println!("ğŸ‘‹ æˆ‘åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ä¸­è¿è¡Œ");
        sleep(Duration::from_secs(1)).await;
        println!("âœ¨ ä»»åŠ¡æ‰§è¡Œå®Œæ¯•");
        42 // è¿”å›å€¼
    });
    
    println!("ğŸ“ ä¸»ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šç­‰å¾… spawn çš„ä»»åŠ¡");
    
    // ä½¿ç”¨ JoinHandle ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ
    match handle.await {
        Ok(result) => println!("ğŸ¯ ä»»åŠ¡è¿”å›å€¼: {}", result),
        Err(e) => println!("âŒ ä»»åŠ¡å¤±è´¥: {:?}", e),
    }
}
```

**`tokio::spawn` çš„ç‰¹ç‚¹ï¼š**
- åˆ›å»º**ç‹¬ç«‹çš„å¼‚æ­¥ä»»åŠ¡**ï¼ˆç±»ä¼¼è½»é‡çº§çº¿ç¨‹ï¼‰
- ä»»åŠ¡åœ¨åå°**å¹¶å‘æ‰§è¡Œ**
- è¿”å› `JoinHandle` ç”¨äºç­‰å¾…å’Œè·å–ç»“æœ
- ä»»åŠ¡å¿…é¡»æ˜¯ `'static` ç”Ÿå‘½å‘¨æœŸ

---

#### 2.2.3 å¹¶å‘æ‰§è¡Œ

```rust
async fn multiple_spawns() {
    let start = std::time::Instant::now();
    
    // åˆ›å»ºå¤šä¸ªä»»åŠ¡ï¼Œå®ƒä»¬ä¼šå¹¶å‘æ‰§è¡Œ
    let handle1 = tokio::spawn(async_task(1, 2));
    let handle2 = tokio::spawn(async_task(2, 1));
    let handle3 = tokio::spawn(async_task(3, 3));
    
    // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    let (result1, result2, result3) = tokio::join!(handle1, handle2, handle3);
    
    println!("æ€»è€—æ—¶: {:.1} ç§’ï¼ˆå¹¶å‘æ‰§è¡Œï¼‰", start.elapsed().as_secs_f64());
}
```

**å¹¶å‘æ¨¡å¼ï¼š**
- `tokio::join!` - ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
- `tokio::select!` - ç­‰å¾…ç¬¬ä¸€ä¸ªå®Œæˆçš„ä»»åŠ¡
- `tokio::spawn` - åˆ›å»ºç‹¬ç«‹å¹¶å‘ä»»åŠ¡

---

#### 2.2.4 é˜»å¡ä»»åŠ¡å¤„ç†

```rust
async fn blocking_task() {
    // spawn_blocking ç”¨äºè¿è¡Œä¼šé˜»å¡çš„åŒæ­¥ä»£ç 
    let handle = tokio::task::spawn_blocking(|| {
        // æ¨¡æ‹Ÿ CPU å¯†é›†å‹è®¡ç®—
        let mut sum = 0u64;
        for i in 0..100_000_000 {
            sum += i;
        }
        sum
    });
    
    println!("ğŸ“ ä¸»ä»»åŠ¡å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–å¼‚æ­¥æ“ä½œ");
    
    let result = handle.await.unwrap();
    println!("âœ… è®¡ç®—å®Œæˆï¼Œç»“æœ: {}", result);
}
```

**é‡è¦ï¼** CPU å¯†é›†å‹ä»»åŠ¡ä¼šé˜»å¡å¼‚æ­¥è¿è¡Œæ—¶ï¼Œåº”ä½¿ç”¨ `spawn_blocking`ã€‚

---

#### 2.2.5 å¼‚æ­¥ I/O

Tokio æä¾›å¼‚æ­¥ç‰ˆæœ¬çš„å¸¸è§ I/O æ“ä½œï¼š

```rust
// å¼‚æ­¥ç½‘ç»œ
use tokio::net::TcpListener;
let listener = TcpListener::bind("127.0.0.1:8080").await?;

// å¼‚æ­¥æ–‡ä»¶
use tokio::fs::File;
let file = File::open("data.txt").await?;

// å¼‚æ­¥è®¡æ—¶å™¨
use tokio::time::{sleep, Duration};
sleep(Duration::from_secs(1)).await;
```

---

#### 2.2.6 åŒæ­¥åŸè¯­ï¼ˆSynchronizationï¼‰

##### **Channel é€šä¿¡**
```rust
use tokio::sync::mpsc;

// åˆ›å»º channel
let (tx, mut rx) = mpsc::channel(100);

// å‘é€
tx.send(42).await.unwrap();

// æ¥æ”¶
if let Some(value) = rx.recv().await {
    println!("æ”¶åˆ°: {}", value);
}
```

##### **äº’æ–¥é”**
```rust
use tokio::sync::Mutex;
use std::sync::Arc;

let data = Arc::new(Mutex::new(0));

// å¯ä»¥åœ¨ .await ç‚¹æŒæœ‰é”
let mut guard = data.lock().await;
*guard += 1;
```

##### **ä¿¡å·é‡**
```rust
use tokio::sync::Semaphore;

let semaphore = Arc::new(Semaphore::new(3)); // æœ€å¤š3ä¸ªå¹¶å‘
let permit = semaphore.acquire().await.unwrap();
// æ‰§è¡Œå·¥ä½œ
drop(permit); // é‡Šæ”¾è®¸å¯
```

---

### 2.3 Tokio æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ä½ çš„å¼‚æ­¥ä»£ç                   â”‚
â”‚    (async/await + Tokio API)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Tokio è¿è¡Œæ—¶                  â”‚
â”‚  â€¢ ä»»åŠ¡è°ƒåº¦å™¨                        â”‚
â”‚  â€¢ I/O äº‹ä»¶å¾ªç¯                      â”‚
â”‚  â€¢ è®¡æ—¶å™¨ç®¡ç†                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        æ“ä½œç³»ç»Ÿ                      â”‚
â”‚  â€¢ çº¿ç¨‹                              â”‚
â”‚  â€¢ ç½‘ç»œ/æ–‡ä»¶ I/O                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.4 Tokio vs æ ‡å‡†åº“

| åŠŸèƒ½ | æ ‡å‡†åº“ (std) | Tokio |
|------|------------|-------|
| æ‰§è¡Œæ¨¡å‹ | é˜»å¡ | å¼‚æ­¥ |
| Mutex | `std::sync::Mutex` | `tokio::sync::Mutex` |
| Channel | `std::sync::mpsc` | `tokio::sync::mpsc` |
| ç½‘ç»œ | `std::net` | `tokio::net` |
| æ–‡ä»¶ | `std::fs` | `tokio::fs` |
| Sleep | `std::thread::sleep` | `tokio::time::sleep` |

**å…³é”®åŒºåˆ«ï¼š**
- âœ… Tokio çš„ API æ˜¯ **async** çš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹
- âœ… å¯ä»¥ç”¨å°‘é‡çº¿ç¨‹å¤„ç†å¤§é‡å¹¶å‘è¿æ¥
- âœ… é€‚åˆ I/O å¯†é›†å‹åº”ç”¨ï¼ˆç½‘ç»œæœåŠ¡ã€æ•°æ®åº“ç­‰ï¼‰

---

### 2.5 ä½•æ—¶ä½¿ç”¨ Tokioï¼Ÿ

#### âœ… **é€‚åˆä½¿ç”¨ï¼š**
- ğŸŒ Web æœåŠ¡å™¨ï¼ˆå¦‚ Axumã€Actix-webï¼‰
- ğŸ”Œ ç½‘ç»œåº”ç”¨ï¼ˆèŠå¤©ã€æ¸¸æˆæœåŠ¡å™¨ï¼‰
- ğŸ—„ï¸ æ•°æ®åº“å®¢æˆ·ç«¯
- ğŸ•·ï¸ ç½‘é¡µçˆ¬è™«
- ğŸ“¡ API å®¢æˆ·ç«¯
- ğŸ”„ éœ€è¦å¤„ç†å¤§é‡å¹¶å‘ I/O

#### âŒ **ä¸é€‚åˆï¼š**
- ğŸ§® CPU å¯†é›†å‹è®¡ç®—ï¼ˆç”¨ `rayon`ï¼‰
- ğŸ”§ ç®€å•è„šæœ¬ï¼ˆç”¨åŒæ­¥ä»£ç æ›´ç®€å•ï¼‰
- ğŸ“Š æ•°æ®å¤„ç†ï¼ˆé™¤éæ¶‰åŠ I/Oï¼‰

---

### 2.6 å¿«é€Ÿå¼€å§‹

**1. æ·»åŠ ä¾èµ–ï¼š**
```toml
[dependencies]
tokio = { version = "1", features = ["full"] }
```

**2. åˆ›å»ºå¼‚æ­¥ mainï¼š**
```rust
#[tokio::main]
async fn main() {
    println!("Hello, Tokio!");
}
```

---

### 2.7 Tokio ç”Ÿæ€ç³»ç»Ÿ

- **[Axum](https://github.com/tokio-rs/axum)** - Web æ¡†æ¶
- **[Tonic](https://github.com/hyperium/tonic)** - gRPC
- **[Reqwest](https://github.com/seanmonstar/reqwest)** - HTTP å®¢æˆ·ç«¯
- **[SQLx](https://github.com/launchbadge/sqlx)** - å¼‚æ­¥æ•°æ®åº“
- **[Tower](https://github.com/tower-rs/tower)** - æœåŠ¡æŠ½è±¡

---

### 2.8 å…³é”®æ€»ç»“

1. **Tokio æ˜¯å¼‚æ­¥è¿è¡Œæ—¶** - é©±åŠ¨ async/await æ‰§è¡Œ
2. **è½»é‡çº§ä»»åŠ¡** - ç”¨ `tokio::spawn` åˆ›å»ºæˆåƒä¸Šä¸‡çš„å¹¶å‘ä»»åŠ¡
3. **éé˜»å¡ I/O** - é«˜æ•ˆå¤„ç†ç½‘ç»œã€æ–‡ä»¶æ“ä½œ
4. **ä¸°å¯Œçš„å·¥å…·** - Channelã€Mutexã€Semaphore ç­‰
5. **ç”Ÿæ€ç³»ç»Ÿ** - è®¸å¤šåº“åŸºäº Tokio æ„å»º

**ä¸€å¥è¯æ€»ç»“ï¼š** Tokio è®© Rust èƒ½å¤Ÿç¼–å†™é«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„å¼‚æ­¥åº”ç”¨ç¨‹åºï¼ğŸš€

---

## 3. tokio::spawn æ‰§è¡Œæœºåˆ¶

### 3.1 æ ¸å¿ƒç­”æ¡ˆ

**ä»»åŠ¡åœ¨ `tokio::spawn` è°ƒç”¨åç«‹å³å¼€å§‹æ‰§è¡Œï¼**

`handle.await` **ä¸æ˜¯ç”¨æ¥å¯åŠ¨ä»»åŠ¡çš„**ï¼Œè€Œæ˜¯ç”¨æ¥**ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ**ã€‚

---

### 3.2 æ‰§è¡Œé¡ºåºè¯¦è§£

```rust
async fn basic_spawn() {
    // spawn åˆ›å»ºä¸€ä¸ªæ–°çš„å¼‚æ­¥ä»»åŠ¡ï¼Œç«‹å³è¿”å› JoinHandle
    let handle = tokio::spawn(async {
        println!("ğŸ‘‹ æˆ‘åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ä¸­è¿è¡Œ");
        sleep(Duration::from_secs(1)).await;
        println!("âœ¨ ä»»åŠ¡æ‰§è¡Œå®Œæ¯•");
        42 // è¿”å›å€¼
    });
    
    println!("ğŸ“ ä¸»ä»»åŠ¡ç»§ç»­æ‰§è¡Œï¼Œä¸ä¼šç­‰å¾… spawn çš„ä»»åŠ¡");
    
    // ä½¿ç”¨ JoinHandle ç­‰å¾…ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ
    match handle.await {
        Ok(result) => println!("ğŸ¯ ä»»åŠ¡è¿”å›å€¼: {}", result),
        Err(e) => println!("âŒ ä»»åŠ¡å¤±è´¥: {:?}", e),
    }
}
```

**æ‰§è¡Œé¡ºåºï¼š**
```
1. tokio::spawn(...) è¢«è°ƒç”¨
   â†“ ä»»åŠ¡ç«‹å³æäº¤åˆ°è¿è¡Œæ—¶è°ƒåº¦å™¨
   â†“ ç«‹å³è¿”å› JoinHandle
   
2. println!("ğŸ“ ä¸»ä»»åŠ¡ç»§ç»­æ‰§è¡Œ...") ç«‹å³æ‰§è¡Œ
   â†“ æ­¤æ—¶ spawn çš„ä»»åŠ¡å·²ç»åœ¨åå°è¿è¡Œäº†ï¼
   
3. handle.await è¢«è°ƒç”¨
   â†“ ç­‰å¾…ä»»åŠ¡å®Œæˆï¼ˆä¸æ˜¯å¯åŠ¨ä»»åŠ¡ï¼‰
   â†“ è·å–è¿”å›å€¼ 42
```

---

### 3.3 è¯æ˜ç¤ºä¾‹

```rust
#[tokio::main]
async fn main() {
    println!("æ—¶åˆ» 0: ä¸»ä»»åŠ¡å¼€å§‹");
    
    // åˆ›å»ºä»»åŠ¡ï¼Œç«‹å³å¼€å§‹æ‰§è¡Œ
    let handle = tokio::spawn(async {
        println!("æ—¶åˆ» 1: spawn çš„ä»»åŠ¡å¼€å§‹æ‰§è¡Œ");
        sleep(Duration::from_secs(2)).await;
        println!("æ—¶åˆ» 3: spawn çš„ä»»åŠ¡å®Œæˆ");
        42
    });
    
    println!("æ—¶åˆ» 2: ä¸»ä»»åŠ¡ç»§ç»­ï¼Œè¿˜æ²¡æœ‰ await handle");
    
    // è¿™é‡Œæ•…æ„ç­‰å¾…ä¸€ä¸‹ï¼Œè¯æ˜ spawn çš„ä»»åŠ¡åœ¨ç‹¬ç«‹è¿è¡Œ
    sleep(Duration::from_secs(1)).await;
    println!("æ—¶åˆ» 2.5: ä¸»ä»»åŠ¡ç­‰å¾…äº† 1 ç§’");
    
    // ç°åœ¨æ‰ await handle
    println!("æ—¶åˆ» 2.8: ç°åœ¨å¼€å§‹ await handle");
    let result = handle.await.unwrap();
    println!("æ—¶åˆ» 4: è·å–ç»“æœ: {}", result);
}
```

**è¾“å‡ºé¡ºåºï¼š**
```
æ—¶åˆ» 0: ä¸»ä»»åŠ¡å¼€å§‹
æ—¶åˆ» 1: spawn çš„ä»»åŠ¡å¼€å§‹æ‰§è¡Œ  â† ç«‹å³å¼€å§‹ï¼
æ—¶åˆ» 2: ä¸»ä»»åŠ¡ç»§ç»­ï¼Œè¿˜æ²¡æœ‰ await handle
æ—¶åˆ» 2.5: ä¸»ä»»åŠ¡ç­‰å¾…äº† 1 ç§’
æ—¶åˆ» 2.8: ç°åœ¨å¼€å§‹ await handle
æ—¶åˆ» 3: spawn çš„ä»»åŠ¡å®Œæˆ
æ—¶åˆ» 4: è·å–ç»“æœ: 42
```

**å…³é”®è§‚å¯Ÿï¼š** "æ—¶åˆ» 1" åœ¨ "æ—¶åˆ» 2" ä¹‹å‰è¾“å‡ºï¼Œè¯æ˜ä»»åŠ¡åœ¨ `spawn` æ—¶å°±å¼€å§‹æ‰§è¡Œäº†ï¼

---

### 3.4 å¯¹æ¯”ï¼šæ™®é€š async å‡½æ•°

```rust
// æ™®é€š async å‡½æ•° - æƒ°æ€§çš„
let future = async_function();  // âŒ ä¸ä¼šæ‰§è¡Œ
println!("è¿˜æ²¡æ‰§è¡Œ");
let result = future.await;      // âœ… ç°åœ¨æ‰æ‰§è¡Œ

// tokio::spawn - ç«‹å³æ‰§è¡Œ
let handle = tokio::spawn(async_function());  // âœ… ç«‹å³æ‰§è¡Œï¼
println!("å·²ç»åœ¨æ‰§è¡Œäº†");
let result = handle.await.unwrap();  // åªæ˜¯ç­‰å¾…ç»“æœ
```

---

### 3.5 å¤šä»»åŠ¡å¹¶å‘è¯æ˜

```rust
async fn multiple_spawns() {
    let start = std::time::Instant::now();
    
    // åˆ›å»ºå¤šä¸ªä»»åŠ¡ï¼Œå®ƒä»¬ä¼šå¹¶å‘æ‰§è¡Œ
    let handle1 = tokio::spawn(async_task(1, 2));  // 2ç§’
    let handle2 = tokio::spawn(async_task(2, 1));  // 1ç§’
    let handle3 = tokio::spawn(async_task(3, 3));  // 3ç§’
    
    println!("ğŸ“ æ‰€æœ‰ä»»åŠ¡å·²å¯åŠ¨ï¼Œç°åœ¨ç­‰å¾…å®ƒä»¬å®Œæˆ...\n");
    
    // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    let (result1, result2, result3) = tokio::join!(handle1, handle2, handle3);
    
    println!("â±ï¸  æ€»è€—æ—¶: {:.1} ç§’ï¼ˆå¹¶å‘æ‰§è¡Œï¼‰", start.elapsed().as_secs_f64());
}
```

**æ‰§è¡Œæµç¨‹ï¼š**
```
1. handle1 = tokio::spawn(...)  â†’ ä»»åŠ¡1 å¼€å§‹æ‰§è¡Œï¼ˆ2ç§’ï¼‰
2. handle2 = tokio::spawn(...)  â†’ ä»»åŠ¡2 å¼€å§‹æ‰§è¡Œï¼ˆ1ç§’ï¼‰
3. handle3 = tokio::spawn(...)  â†’ ä»»åŠ¡3 å¼€å§‹æ‰§è¡Œï¼ˆ3ç§’ï¼‰
   â†“ ä¸‰ä¸ªä»»åŠ¡ç°åœ¨éƒ½åœ¨å¹¶å‘è¿è¡Œï¼
4. println!("æ‰€æœ‰ä»»åŠ¡å·²å¯åŠ¨...")  â†’ è¯æ˜ä¸éœ€è¦ await å°±å·²ç»å¯åŠ¨
   â†“
5. tokio::join!(...)  â†’ ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
   â†“ æ€»è€—æ—¶çº¦ 3 ç§’ï¼ˆæœ€é•¿çš„ä»»åŠ¡ï¼‰ï¼Œè€Œä¸æ˜¯ 6 ç§’ï¼ˆå¦‚æœä¸²è¡Œï¼‰
```

---

### 3.6 ç”šè‡³å¯ä»¥ä¸ await

ä½ ç”šè‡³å¯ä»¥**ä¸ await handle**ï¼Œä»»åŠ¡ä¾ç„¶ä¼šæ‰§è¡Œï¼š

```rust
#[tokio::main]
async fn main() {
    // åˆ›å»ºä»»åŠ¡ä½†ä¸ await
    tokio::spawn(async {
        println!("æˆ‘ä¼šæ‰§è¡Œï¼");
        sleep(Duration::from_secs(1)).await;
        println!("å®Œæˆï¼");
    });
    
    // ä¸ await handleï¼Œä½†ä»»åŠ¡ä»ç„¶ä¼šè¿è¡Œ
    
    // ç­‰å¾…ä¸€ä¸‹è®©ä»»åŠ¡æœ‰æ—¶é—´å®Œæˆ
    sleep(Duration::from_secs(2)).await;
}
```

**è¾“å‡ºï¼š**
```
æˆ‘ä¼šæ‰§è¡Œï¼
å®Œæˆï¼
```

---

### 3.7 æ€»ç»“è¡¨æ ¼

| æ“ä½œ | ä»»åŠ¡æ˜¯å¦æ‰§è¡Œ | è¯´æ˜ |
|------|------------|------|
| `let future = async {...}` | âŒ ä¸æ‰§è¡Œ | Future æ˜¯æƒ°æ€§çš„ |
| `future.await` | âœ… ç°åœ¨æ‰§è¡Œ | é©±åŠ¨ Future æ‰§è¡Œ |
| `let handle = tokio::spawn(...)` | âœ… **ç«‹å³æ‰§è¡Œ** | æäº¤åˆ°è¿è¡Œæ—¶ |
| `handle.await` | â³ ç­‰å¾…å®Œæˆ | åªæ˜¯ç­‰å¾…ï¼Œä¸æ˜¯å¯åŠ¨ |
| ä¸ await handle | âœ… ä»ç„¶æ‰§è¡Œ | ä»»åŠ¡ç‹¬ç«‹è¿è¡Œ |

**å…³é”®ç‚¹ï¼š**
1. âœ… `tokio::spawn` è°ƒç”¨åï¼Œä»»åŠ¡**ç«‹å³**è¢«è°ƒåº¦æ‰§è¡Œ
2. âœ… `handle.await` åªæ˜¯**ç­‰å¾…ç»“æœ**ï¼Œä¸æ˜¯å¯åŠ¨ä»»åŠ¡
3. âœ… å³ä½¿ä¸ await handleï¼Œä»»åŠ¡ä¹Ÿä¼šæ‰§è¡Œï¼ˆä½†ä½ æ‹¿ä¸åˆ°è¿”å›å€¼ï¼‰
4. âœ… è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤šä¸ª spawn å¯ä»¥å¹¶å‘æ‰§è¡Œ

**è®°å¿†å£è¯€ï¼š**
- `async {...}` = å†™è®¡åˆ’ï¼ˆä¸æ‰§è¡Œï¼‰
- `tokio::spawn(...)` = å¯åŠ¨ä»»åŠ¡ï¼ˆç«‹å³æ‰§è¡Œï¼‰
- `handle.await` = ç­‰å¾…ç»“æœï¼ˆä¸æ˜¯å¯åŠ¨ï¼‰

---

## 4. ä¼˜é›…å…³é—­ä¸ Broadcast Channel

### 4.1 é—®é¢˜ï¼šå•æ¬¡å‘é€å¦‚ä½•é€šçŸ¥æ‰€æœ‰ä»»åŠ¡ï¼Ÿ

åœ¨ä¼˜é›…å…³é—­çš„å®ç°ä¸­ï¼Œåªè°ƒç”¨ä¸€æ¬¡ `shutdown_tx.send()`ï¼Œä½†æ‰€æœ‰ä»»åŠ¡éƒ½èƒ½æ”¶åˆ°å…³é—­ä¿¡å·ã€‚è¿™æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

---

### 4.2 ç­”æ¡ˆï¼šä½¿ç”¨ broadcast channel

**æ˜¯çš„ï¼Œæ‰€æœ‰ä»»åŠ¡éƒ½èƒ½æ”¶åˆ°å…³é—­ä¿¡å·ï¼**

åŸå› æ˜¯ä½¿ç”¨äº† **`tokio::sync::broadcast` channel**ï¼Œè¿™æ˜¯ä¸€ä¸ª**å¹¿æ’­** channelã€‚

---

### 4.3 ä»£ç ç¤ºä¾‹

```rust
async fn graceful_shutdown_demo() {
    use tokio::sync::broadcast;
    
    let (shutdown_tx, _) = broadcast::channel::<()>(1);
    
    // æ¨¡æ‹Ÿä¸€äº›é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
    let mut tasks = vec![];
    
    for i in 1..=3 {
        let mut shutdown_rx = shutdown_tx.subscribe();  // æ¯ä¸ªä»»åŠ¡è®¢é˜…
        let task = tokio::spawn(async move {
            loop {
                tokio::select! {
                    _ = shutdown_rx.recv() => {
                        println!("   ğŸ›‘ ä»»åŠ¡ {} æ”¶åˆ°å…³é—­ä¿¡å·", i);
                        break;
                    }
                    _ = sleep(Duration::from_millis(500)) => {
                        println!("   ğŸ”„ ä»»åŠ¡ {} è¿è¡Œä¸­...", i);
                    }
                }
            }
            
            println!("   âœ… ä»»åŠ¡ {} æ¸…ç†å®Œæˆ", i);
        });
        tasks.push(task);
    }
    
    // æ¨¡æ‹Ÿæ¥æ”¶å…³é—­ä¿¡å·
    sleep(Duration::from_secs(2)).await;
    println!("\nğŸ“¢ å‘é€å…³é—­ä¿¡å·...\n");
    let _ = shutdown_tx.send(());  // åªå‘é€ä¸€æ¬¡ï¼
    
    // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    for task in tasks {
        let _ = task.await;
    }
    
    println!("\nâœ… æ‰€æœ‰ä»»åŠ¡å·²ä¼˜é›…å…³é—­");
}
```

---

### 4.4 å·¥ä½œåŸç†

#### 4.4.1 broadcast channel çš„ç‰¹æ€§

è¿™æ˜¯ä¸€ä¸ª **å¹¿æ’­** channelï¼Œä¸åŒäº `mpsc` (å¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…)ï¼š
- `broadcast::channel` å…è®¸**å¤šä¸ªæ¥æ”¶è€…**æ¥æ”¶åŒä¸€æ¡æ¶ˆæ¯
- æ¯ä¸ªæ¥æ”¶è€…éƒ½ä¼šæ”¶åˆ°å‘é€çš„**æ¶ˆæ¯å‰¯æœ¬**

#### 4.4.2 æ¯ä¸ªä»»åŠ¡éƒ½è®¢é˜…äº† channel

```rust
let mut shutdown_rx = shutdown_tx.subscribe();
```

æ¯ä¸ªä»»åŠ¡é€šè¿‡ `.subscribe()` åˆ›å»ºäº†è‡ªå·±çš„æ¥æ”¶ç«¯ï¼Œè¿™æ ·æ¯ä¸ªä»»åŠ¡éƒ½æœ‰ç‹¬ç«‹çš„æ¥æ”¶å™¨ã€‚

#### 4.4.3 å•æ¬¡å‘é€ï¼Œå¤šæ¬¡æ¥æ”¶

```rust
shutdown_tx.send(())  // åªå‘é€ä¸€æ¬¡
```

ä½†æ‰€æœ‰é€šè¿‡ `subscribe()` åˆ›å»ºçš„æ¥æ”¶å™¨éƒ½ä¼šæ”¶åˆ°è¿™ä¸ªä¿¡å·ï¼

---

### 4.5 å¯¹æ¯” mpsc channel

å¦‚æœä½¿ç”¨ `mpsc` channelï¼Œæƒ…å†µå°±ä¸åŒäº†ï¼š
- `mpsc` æ˜¯å¤šç”Ÿäº§è€…**å•æ¶ˆè´¹è€…**
- ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«**ä¸€ä¸ª**æ¥æ”¶è€…æ¶ˆè´¹
- ä¸é€‚åˆå¹¿æ’­åœºæ™¯

**ç¤ºä¾‹å¯¹æ¯”ï¼š**

```rust
// âŒ ä½¿ç”¨ mpsc - åªæœ‰ä¸€ä¸ªä»»åŠ¡èƒ½æ”¶åˆ°
let (tx, mut rx) = mpsc::channel(1);
tx.send(()).await.unwrap();
// åªæœ‰ç¬¬ä¸€ä¸ª rx.recv() ä¼šæ”¶åˆ°ï¼Œå…¶ä»–ä»»åŠ¡æ”¶ä¸åˆ°

// âœ… ä½¿ç”¨ broadcast - æ‰€æœ‰ä»»åŠ¡éƒ½èƒ½æ”¶åˆ°
let (tx, _) = broadcast::channel(1);
let mut rx1 = tx.subscribe();
let mut rx2 = tx.subscribe();
let mut rx3 = tx.subscribe();
tx.send(()).unwrap();
// rx1ã€rx2ã€rx3 éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯
```

---

### 4.6 ç¤ºæ„å›¾

```
                   shutdown_tx.send(())
                          |
         å¹¿æ’­åˆ°æ‰€æœ‰è®¢é˜…è€…ï¼ˆä¸€æ¬¡å‘é€ï¼‰
         /                |                \
    shutdown_rx1      shutdown_rx2      shutdown_rx3
        |                 |                 |
     ä»»åŠ¡1              ä»»åŠ¡2             ä»»åŠ¡3
   (éƒ½èƒ½æ”¶åˆ°)         (éƒ½èƒ½æ”¶åˆ°)        (éƒ½èƒ½æ”¶åˆ°)
```

---

### 4.7 å®Œæ•´æ‰§è¡Œæµç¨‹

```
1. åˆ›å»º broadcast channel
   let (shutdown_tx, _) = broadcast::channel::<()>(1);

2. æ¯ä¸ªä»»åŠ¡è®¢é˜… channel
   let mut shutdown_rx = shutdown_tx.subscribe();

3. ä»»åŠ¡åœ¨ loop ä¸­ä½¿ç”¨ tokio::select! ç›‘å¬å…³é—­ä¿¡å·
   select! {
       _ = shutdown_rx.recv() => break,  // æ”¶åˆ°ä¿¡å·å°±é€€å‡º
       _ = sleep(...) => continue,        // å¦åˆ™ç»§ç»­å·¥ä½œ
   }

4. å‘é€å…³é—­ä¿¡å·ï¼ˆåªå‘é€ä¸€æ¬¡ï¼‰
   shutdown_tx.send(());

5. æ‰€æœ‰è®¢é˜…è€…éƒ½æ”¶åˆ°ä¿¡å·
   âœ… ä»»åŠ¡1 æ”¶åˆ° â†’ æ¸…ç†å¹¶é€€å‡º
   âœ… ä»»åŠ¡2 æ”¶åˆ° â†’ æ¸…ç†å¹¶é€€å‡º
   âœ… ä»»åŠ¡3 æ”¶åˆ° â†’ æ¸…ç†å¹¶é€€å‡º

6. ä¸»ä»»åŠ¡ç­‰å¾…æ‰€æœ‰å­ä»»åŠ¡å®Œæˆ
   for task in tasks { task.await; }

7. å®Œæˆä¼˜é›…å…³é—­
```

---

### 4.8 å…³é”®æ€»ç»“

1. **broadcast channel æ˜¯å¹¿æ’­é€šé“**
   - ä¸€å¯¹å¤šé€šä¿¡
   - æ¯ä¸ªè®¢é˜…è€…éƒ½æ”¶åˆ°æ¶ˆæ¯å‰¯æœ¬

2. **é€šè¿‡ subscribe() åˆ›å»ºæ¥æ”¶å™¨**
   - æ¯ä¸ªä»»åŠ¡è°ƒç”¨ `tx.subscribe()`
   - åˆ›å»ºç‹¬ç«‹çš„æ¥æ”¶ç«¯

3. **å•æ¬¡å‘é€ï¼Œå¤šæ¬¡æ¥æ”¶**
   - `tx.send()` åªè°ƒç”¨ä¸€æ¬¡
   - æ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°

4. **é€‚åˆä¼˜é›…å…³é—­åœºæ™¯**
   - é€šçŸ¥æ‰€æœ‰ä»»åŠ¡åœæ­¢
   - ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ¸…ç†å®Œæˆ
   - é¿å…å¼ºåˆ¶ç»ˆæ­¢

**ä¸€å¥è¯æ€»ç»“ï¼š** å³ä½¿åªè°ƒç”¨ä¸€æ¬¡ `send()`ï¼Œæ‰€æœ‰è®¢é˜…äº† broadcast channel çš„ä»»åŠ¡éƒ½ä¼šæ”¶åˆ°å…³é—­ä¿¡å·ã€‚è¿™æ­£æ˜¯ä¼˜é›…å…³é—­æ¨¡å¼çš„ç²¾é«“æ‰€åœ¨ï¼

---

## é™„å½•ï¼šChannel ç±»å‹å¯¹æ¯”

| Channel ç±»å‹ | æ¨¡å¼ | ç”¨é€” | ç‰¹ç‚¹ |
|-------------|------|------|------|
| `mpsc` | å¤šå¯¹ä¸€ | å·¥ä½œé˜Ÿåˆ— | ä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¥æ”¶è€…æ¶ˆè´¹ |
| `oneshot` | ä¸€å¯¹ä¸€ | è¯·æ±‚-å“åº” | åªèƒ½å‘é€ä¸€æ¬¡ |
| `broadcast` | ä¸€å¯¹å¤š | å¹¿æ’­é€šçŸ¥ | æ¯ä¸ªè®¢é˜…è€…éƒ½æ”¶åˆ°æ¶ˆæ¯å‰¯æœ¬ |
| `watch` | ä¸€å¯¹å¤š | çŠ¶æ€å…±äº« | åªä¿ç•™æœ€æ–°å€¼ï¼Œæ¥æ”¶è€…å¯ä»¥éšæ—¶è¯»å– |

**ä¼˜é›…å…³é—­ä½¿ç”¨ broadcast çš„åŸå› ï¼š**
- âœ… éœ€è¦åŒæ—¶é€šçŸ¥å¤šä¸ªä»»åŠ¡
- âœ… æ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æ”¶åˆ°ç›¸åŒçš„ä¿¡å·
- âœ… ç®€å•é«˜æ•ˆï¼Œä¸€æ¬¡å‘é€å³å¯

---

## ç»“è¯­

æœ¬æ–‡æ¡£æ€»ç»“äº† Rust å¼‚æ­¥ç¼–ç¨‹çš„å››ä¸ªæ ¸å¿ƒä¸»é¢˜ï¼š

1. **Async/Await** - å¼‚æ­¥ç¼–ç¨‹çš„è¯­æ³•åŸºç¡€
2. **Tokio** - å¼ºå¤§çš„å¼‚æ­¥è¿è¡Œæ—¶
3. **tokio::spawn** - ä»»åŠ¡ç«‹å³æ‰§è¡Œçš„æœºåˆ¶
4. **Broadcast Channel** - ä¼˜é›…å…³é—­çš„å®ç°æ–¹å¼

æŒæ¡è¿™äº›æ¦‚å¿µï¼Œä½ å°±èƒ½å¤Ÿç¼–å†™é«˜æ€§èƒ½ã€é«˜å¹¶å‘çš„ Rust å¼‚æ­¥åº”ç”¨äº†ï¼ğŸš€

---

**ç›¸å…³ä»£ç ç¤ºä¾‹ä½ç½®ï¼š**
- `src/01_async_basics.rs` - Async/Await åŸºç¡€
- `src/02_tokio_spawn.rs` - Tokio ä»»åŠ¡ç”Ÿæˆ
- `src/06_channels.rs` - Channel é€šä¿¡
- `src/07_practical_example.rs` - ä¼˜é›…å…³é—­ç¤ºä¾‹

**è¿è¡Œç¤ºä¾‹ï¼š**
```bash
cargo run --bin 01_async_basics
cargo run --bin 02_tokio_spawn
cargo run --bin 06_channels
cargo run --bin 07_practical_example
```
